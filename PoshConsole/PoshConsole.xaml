<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Posh="clr-namespace:Huddled.PoshConsole"
    xmlns:aero="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Aero"

    xmlns:d="http://schemas.microsoft.com/expression/blend/2006"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"

    xmlns:PoshProps="clr-namespace:Huddled.PoshConsole.Properties"
	
    x:Class="Huddled.PoshConsole.PoshConsole"
    x:Name="window"
    Title="{Binding Path=buffer.Title}"
    BorderThickness="0"
    Visibility="Visible"
	 AllowsTransparency="True" WindowStyle="None"

    SnapsToDevicePixels="True"
    SourceInitialized="Window_SourceInitialized"
    Closing="Window_Closing"
    LocationChanged="Window_LocationChanged"
    Loaded="Window_Loaded"
    Activated="Window_Activated"
    Deactivated="Window_Deactivated"
	 Background="Transparent"
    ResizeMode="CanResizeWithGrip"
    SizeChanged="Window_SizeChanged"
    >
    <Window.Resources>
        <ObjectDataProvider x:Key="SettingsDS" d:IsDataSource="True" ObjectType="{x:Type PoshProps:Settings}"/>
        <Style x:Key="{x:Type TextBoxBase}" BasedOn="{x:Null}" TargetType="{x:Type TextBoxBase}">
            <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
            <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"/>

            <Setter Property="Padding" Value="1"/>
            <Setter Property="AllowDrop" Value="true"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBoxBase}">
                        <aero:ListBoxChrome SnapsToDevicePixels="true" x:Name="Bd"
                                                  Background="{TemplateBinding Background}"
                                                  BorderThickness="0"
                                                  BorderBrush="{TemplateBinding BorderBrush}"
                                                  RenderFocused="{TemplateBinding IsKeyboardFocusWithin}"
                                                  RenderMouseOver="{TemplateBinding IsMouseOver}">
                            <ScrollViewer SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" x:Name="PART_ContentHost" Padding="0,0,0,0" />
                        </aero:ListBoxChrome>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Background" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
                                <Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="ConsoleBufferStyle" TargetType="{x:Type Posh:ConsoleTextBox}">
            <Style.Resources>
                <Style x:Key="{x:Type FlowDocument}" TargetType="{x:Type FlowDocument}">
                    <Setter Property="OverridesDefaultStyle" Value="true"/>
                </Style>
            </Style.Resources>
            <Setter Property="MinWidth" Value="10"/>
            <Style.BasedOn>
                <StaticResource ResourceKey="{x:Type TextBoxBase}"/>
            </Style.BasedOn>
        </Style>
        <Style x:Key="WindowBorder" TargetType="{x:Type Border}">
            <Setter Property="BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint=".5,1" SpreadMethod="Pad">
                        <GradientStop Offset="0">
                            <GradientStop.Color>
                                <Binding Path="BorderColorTopLeft" Mode="Default" Source="{StaticResource SettingsDS}"/>
                            </GradientStop.Color>
                        </GradientStop>
                        <GradientStop Offset="0.803">
                            <GradientStop.Color>
                                <Binding Path="BorderColorBottomRight" Mode="Default" Source="{StaticResource SettingsDS}"/>
                            </GradientStop.Color>
                        </GradientStop>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderThickness">
                <Setter.Value>
                    <Binding Path="BorderThickness" Mode="Default" Source="{StaticResource SettingsDS}"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Window.ShowInTaskbar>
        <Binding Path="ShowInTaskbar" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.ShowInTaskbar>
    <Window.Opacity>
        <Binding Path="Opacity" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Opacity>
    <Window.Width>
        <Binding Path="WindowWidth" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Width>
    <Window.Height>
        <Binding Path="WindowHeight" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Height>
    <Window.Left>
        <Binding Path="WindowLeft" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Left>
    <Window.Top>
        <Binding Path="WindowTop" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Top>
    <Window.Topmost>
        <Binding Path="AlwaysOnTop" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Topmost>
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Stop" Executed="HandleControlC" CanExecute="CanHandleControlC"/>
		<CommandBinding Command="NavigationCommands.Zoom" Executed="HandleSetZoom" />
		<CommandBinding Command="NavigationCommands.IncreaseZoom" Executed="HandleIncreaseZoom" />
		<CommandBinding Command="NavigationCommands.DecreaseZoom" Executed="HandleDecreaseZoom" />
	</Window.CommandBindings>
	<Window.InputBindings>
		<!-- <KeyBinding Command="ApplicationCommands.Stop" Key="F2" /> -->
		<KeyBinding Command="NavigationCommands.IncreaseZoom" Key="OemPlus" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.IncreaseZoom" Key="Add" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.DecreaseZoom" Key="Subtract" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.DecreaseZoom" Key="OemMinus" Modifiers="Control" />

		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.0" Key="D0" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.1" Key="D1" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.2" Key="D2" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.3" Key="D3" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.4" Key="D4" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.5" Key="D5" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.6" Key="D6" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.7" Key="D7" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.8" Key="D8" Modifiers="Control" />
		<KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.9" Key="D9" Modifiers="Control" />
	</Window.InputBindings>
    <Border x:Name="border" CornerRadius="5" Style="{DynamicResource WindowBorder}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" MaxHeight="300" MinHeight="0"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Posh:ProgressPanel  Grid.RowSpan="1" Grid.Row="0" Visibility="Collapsed" x:Name="progress" Width="Auto" d:LayoutOverrides="Margin" />
            <Posh:ConsoleTextBox Grid.Row="1" Grid.RowSpan="1" x:Name="buffer" Style="{DynamicResource ConsoleBufferStyle}"
                                 HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                 AcceptsTab="True" 
                                 IsUndoEnabled="False"

                                 Background="#FF000000" Foreground="#FFFFFFFF"
                                 

                                 TabComplete="buffer_TabComplete"
                                 CommandEntered="buffer_CommandEntered"
                                 GetHistory="buffer_GetHistory"
                                 SizeChanged="buffer_SizeChanged"
                                 PreviewMouseWheel="buffer_PreviewMouseWheel"

                                 Padding="0,0,0,0" Margin="0,0,0,0" BorderThickness="0,0,0,0" >
				<Posh:ConsoleTextBox.FontSize>
					<Binding Path="FontSize" Mode="Default" Source="{StaticResource SettingsDS}"/>
				</Posh:ConsoleTextBox.FontSize>
				<Posh:ConsoleTextBox.FontFamily>
					<Binding Path="FontFamily" Mode="Default" Source="{StaticResource SettingsDS}"/>
				</Posh:ConsoleTextBox.FontFamily>
				<Posh:ConsoleTextBox.Resources>
                    <Style TargetType="{x:Type Paragraph}">
                        <Setter Property="Margin" Value="0"/>
                    </Style>
                </Posh:ConsoleTextBox.Resources>
                <FlowDocument>
                	<Paragraph xml:space="preserve">
                        <Floater Margin="0,0,0,0" Padding="0,0,0,0">
                			<Paragraph><Image Height="180" Margin="0,0,0,0" Source="PoshConsoleLogo.png" /></Paragraph>
                		</Floater>
                        <Floater Width="Auto" Margin="0,0,20,0" Padding="0,0,0,0">
                			<Paragraph Padding="5,5,5,5" TextAlignment="Left" FontFamily="Pescadero"><Run FontSize="28" Typography.ContextualSwashes="1" xml:space="preserve">Posh </Run><Run FontSize="28" FontStyle="Italic" Typography.ContextualSwashes="1">adj</Run><Run FontSize="28" Typography.ContextualSwashes="1">., Smart and fashionable</Run></Paragraph>
                			<Paragraph Padding="5,5,5,5" TextAlignment="Right" FontFamily="Pescadero"><Run FontSize="20" Typography.ContextualSwashes="1">PoshConsole: A smarter PowerShell Console</Run><LineBreak/><Run FontSize="20" Typography.ContextualSwashes="1" xml:space="preserve">brought to you by </Run><Run FontFamily="Lindsey" FontSize="20" Typography.ContextualSwashes="1">Joel "</Run><Run FontFamily="Lindsey" FontSize="20" FontStyle="Italic" Typography.ContextualSwashes="1">Jaykul</Run><Run FontFamily="Lindsey" FontSize="20" Typography.ContextualSwashes="1">" Bennett</Run></Paragraph>
                			<Paragraph Padding="5,5,5,5" TextAlignment="Center" FontFamily="Pescadero"><Run FontSize="18" Foreground="#FF178EC8" Typography.ContextualSwashes="1">http://HuddledMasses.org</Run><LineBreak/><Run FontSize="18" Foreground="#FF178EC8" Typography.ContextualSwashes="1">http://CodeProject.com/PoshConsole/</Run></Paragraph>
                		</Floater>
                    </Paragraph>
                </FlowDocument>
            </Posh:ConsoleTextBox>
        </Grid>
    </Border>
</Window>
