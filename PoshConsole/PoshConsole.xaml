<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:blend="http://schemas.microsoft.com/expression/blend/2006"
    xmlns:PoshControls="clr-namespace:PoshConsole.Controls"
    xmlns:PoshInterop="clr-namespace:PoshConsole.Interop"
    xmlns:Properties="clr-namespace:PoshConsole.Properties"
    
    xmlns:aero="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Aero"
    
    mc:Ignorable="blend"

    x:Class="PoshConsole.PoshConsoleWindow" x:Name="window"
    Title="{Binding Path=Title, ElementName=buffer, Mode=Default}"
    Visibility="Visible" Background="Transparent" AllowsTransparency="False"
    BorderThickness="0"
    ResizeMode="CanResizeWithGrip"
    SnapsToDevicePixels="True"

    SourceInitialized="OnWindowSourceInitialized"
    Loaded="OnWindowLoaded"
    Closing="OnWindowClosing"
    Activated="OnWindowActivated"
    Deactivated="OnWindowDeactivated"
    LocationChanged="OnWindowLocationChanged"
    SizeChanged="OnWindowSizeChanged"
    Icon="pack://application:,,,/Artwork/PoshConsoleWindow.ico"
    >

    <!--
    xmlns:PoshControls="http://schemas.poshconsole.org/controls"
    xmlns:PoshInterop="http://schemas.poshconsole.org/interop"
    xmlns:Properties="http://schemas.poshconsole.org/properties"
    -->

    <Window.Resources>
        <!--<PoshProps:Settings x:Key="SettingsDS" />-->
        <ObjectDataProvider x:Key="SettingsDS" blend:IsDataSource="True" ObjectType="{x:Type Properties:Settings}"/>
        <Style x:Key="ConsoleBufferStyle" TargetType="{x:Type PoshControls:ConsoleRichTextBox}">
            <Style.Resources>
                <Style x:Key="{x:Type FlowDocument}" TargetType="{x:Type FlowDocument}">
                    <Setter Property="OverridesDefaultStyle" Value="true"/>
                </Style>
            </Style.Resources>
            <Setter Property="MinWidth" Value="10"/>
            <Style.BasedOn>
                <StaticResource ResourceKey="{x:Type TextBoxBase}"/>
            </Style.BasedOn>
        </Style>
        <Style x:Key="WindowBorder" TargetType="{x:Type Border}">
            <Setter Property="BorderBrush">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint=".5,1" SpreadMethod="Pad">
                        <GradientStop Offset="0">
                            <GradientStop.Color>
                                <Binding Path="BorderColorTopLeft" Mode="Default" Source="{StaticResource SettingsDS}"/>
                            </GradientStop.Color>
                        </GradientStop>
                        <GradientStop Offset="0.803">
                            <GradientStop.Color>
                                <Binding Path="BorderColorBottomRight" Mode="Default" Source="{StaticResource SettingsDS}"/>
                            </GradientStop.Color>
                        </GradientStop>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderThickness">
                <Setter.Value>
                    <Binding Path="BorderThickness" Mode="Default" Source="{StaticResource SettingsDS}"/>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <PoshInterop:HotkeyService.FocusHotkey>
        <Binding Path="FocusKey" Mode="Default" Source="{StaticResource SettingsDS}" />
    </PoshInterop:HotkeyService.FocusHotkey>
    <Window.ShowInTaskbar>
        <Binding Path="ShowInTaskbar" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.ShowInTaskbar>
    <Window.Opacity>
        <Binding Path="Opacity" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Opacity>
    <Window.Width>
        <Binding Path="WindowWidth" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Width>
    <Window.Height>
        <Binding Path="WindowHeight" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Height>
    <Window.Left>
        <Binding Path="WindowLeft" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Left>
    <Window.Top>
        <Binding Path="WindowTop" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Top>
    <Window.Topmost>
        <Binding Path="AlwaysOnTop" Mode="Default" Source="{StaticResource SettingsDS}"/>
    </Window.Topmost>
    <Window.CommandBindings>
        <CommandBinding Command="ApplicationCommands.Stop" Executed="OnHandleControlC" CanExecute="OnCanHandleControlC"/>
        <!--<CommandBinding Command="ApplicationCommands.Copy" Executed="HandleControlC" CanExecute="CanHandleControlC"/>-->
        
        <!--<CommandBinding Command="ApplicationCommands.ContextMenu" Executed="ContextMenu" />-->
        <CommandBinding Command="NavigationCommands.Zoom" Executed="OnHandleSetZoom" />
        <CommandBinding Command="NavigationCommands.IncreaseZoom" Executed="OnHandleIncreaseZoom" />
        <CommandBinding Command="NavigationCommands.DecreaseZoom" Executed="OnHandleDecreaseZoom" />
    </Window.CommandBindings>
    <Window.InputBindings>
        <!-- 
        <KeyBinding Command="ApplicationCommands.ContextMenu" Key="F7" Modifiers="Control" />
        -->
        
        <!-- Default Binding 
        -->
        <KeyBinding Command="ApplicationCommands.Stop" Key="Esc" />
        <KeyBinding Command="ApplicationCommands.Stop" Key="F2" />
        <KeyBinding Command="ApplicationCommands.Stop" Key="Break" Modifiers="Control" />
        <KeyBinding Command="ApplicationCommands.Stop" Key="C" Modifiers="Control" />
        <!--<KeyBinding Command="ApplicationCommands.Copy" Key="C" Modifiers="Control" />-->

        <KeyBinding Command="NavigationCommands.IncreaseZoom" Key="OemPlus" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.IncreaseZoom" Key="Add" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.DecreaseZoom" Key="Subtract" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.DecreaseZoom" Key="OemMinus" Modifiers="Control" />

        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.0" Key="D0" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.1" Key="D1" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.2" Key="D2" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.3" Key="D3" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.4" Key="D4" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="1.5" Key="D5" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.6" Key="D6" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.7" Key="D7" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.8" Key="D8" Modifiers="Control" />
        <KeyBinding Command="NavigationCommands.Zoom" CommandParameter="0.9" Key="D9" Modifiers="Control" />


    </Window.InputBindings>
    <Border x:Name="border" CornerRadius="5" Style="{DynamicResource WindowBorder}" Visibility="Visible" BorderThickness="{Binding Path=BorderThickness, Mode=Default, Source={StaticResource SettingsDS}}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" MaxHeight="300" MinHeight="0"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto" MaxHeight="22" MinHeight="0"/>
            </Grid.RowDefinitions>
            <PoshControls:ProgressPanel         Grid.Row="0" Visibility="Collapsed" x:Name="progress" Width="Auto" blend:LayoutOverrides="Margin" />
            <PoshControls:ConsoleRichTextBox    Grid.Row="1" x:Name="buffer" Style="{DynamicResource ConsoleBufferStyle}"
                                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                        AcceptsTab="True"
                                        IsDocumentEnabled="True"
                                        IsUndoEnabled="True"
                                        ForceCursor="True"
                                        Background="#FF000000"
                                        Foreground="#FFFFFFFF"
                                        PreviewMouseWheel="buffer_PreviewMouseWheel"
                                        Padding="0,0,0,0" Margin="0,0,0,0" BorderThickness="0,0,0,0" WindowTitle="PoshConsole"
                                        VerticalScrollBarVisibility="{Binding Path=ScrollBarVisibility, Mode=Default, Source={StaticResource SettingsDS}}"
                                        FontFamily="/FontLibrary;Component/#Bitstream Vera Sans Mono"
                                        >

                <PoshControls:ConsoleRichTextBox.Resources>
                    <Style TargetType="{x:Type Paragraph}">
                        <Setter Property="Margin" Value="0"/>
                    </Style>
                </PoshControls:ConsoleRichTextBox.Resources>
                <PoshControls:ConsoleRichTextBox.FontSize>
                    <Binding Path="FontSize" Mode="OneWay" Source="{StaticResource SettingsDS}"/>
                </PoshControls:ConsoleRichTextBox.FontSize>
                <!--FontFamily="/FontLibrary;Component/#Bitstream Vera Sans Mono"-->
                <!--<Posh:ConsoleRichTextBox.FontFamily>
                    <Binding Path="FontFamily" Mode="OneWay" Source="{StaticResource SettingsDS}"/>
                </Posh:ConsoleRichTextBox.FontFamily>-->
                <PoshControls:ConsoleRichTextBox.ContextMenu>
                    <ContextMenu/>
                </PoshControls:ConsoleRichTextBox.ContextMenu>
                <FlowDocument>
                    <Paragraph />
                </FlowDocument>

            </PoshControls:ConsoleRichTextBox>
            <StatusBar Grid.Row="2" Padding="0,2,0,0" Margin="0,0,0,0" x:Name="status" OpacityMask="#FE000000"
                       Background="{Binding Path=Background, ElementName=buffer, Mode=Default}"
                       Foreground="{Binding Path=Foreground, ElementName=buffer, Mode=Default}" BorderThickness="0,1,0,0"
                       HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" BorderBrush="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" >
                <!--<StatusBar.BitmapEffect>
        			<BevelBitmapEffect BevelWidth="2" EdgeProfile="CurvedIn" Relief="0.17" Smoothness="0.5"/>
        		</StatusBar.BitmapEffect>-->
                <StatusBarItem x:Name="title" Padding="4,0,4,0" DockPanel.Dock="Left" Content="{Binding Path=Title, ElementName=buffer, Mode=Default}" >
                    <StatusBarItem.BitmapEffect>
                        <DropShadowBitmapEffect/>
                    </StatusBarItem.BitmapEffect>
                </StatusBarItem>

                <Separator DockPanel.Dock="Left" />

                <StatusBarItem x:Name="admin" Padding="4,0,4,0" DockPanel.Dock="Right" HorizontalContentAlignment="Right" Content="Normal" Cursor="Hand" ToolTip="Double Click to re-start as administrator" FontWeight="Bold" Foreground="#FF11CC11" MouseDoubleClick="OnAdminMouseDoubleClick" >
                    <StatusBarItem.BitmapEffect>
                        <DropShadowBitmapEffect/>
                    </StatusBarItem.BitmapEffect>
                </StatusBarItem>

                <Separator DockPanel.Dock="Right" />

                <!-- Last item is docked in center, as usual. -->
                <StatusBarItem HorizontalAlignment="Center" HorizontalContentAlignment="Center" Content="" Width="Auto" x:Name="statusMiddle" >
                    <StatusBarItem.BitmapEffect>
                        <DropShadowBitmapEffect/>
                    </StatusBarItem.BitmapEffect>
                </StatusBarItem>
            </StatusBar>
        </Grid>
    </Border>
</Window>
